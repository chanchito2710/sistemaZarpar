# ğŸ¤– INSTRUCCIONES PARA EL AGENTE IA - SISTEMA ZARPAR

> **âš ï¸ LEER OBLIGATORIAMENTE AL INICIO DE CADA CONVERSACIÃ“N**

---

## ğŸ“¦ INSTALACIÃ“N DESDE CERO (Para Nueva MÃ¡quina)

### ğŸ¯ OBJETIVO
Levantar el proyecto completo en una mÃ¡quina nueva desde el repositorio de GitHub, incluyendo Docker, MySQL, frontend y backend.

---

### âœ… PREREQUISITOS

#### 1. Sistema Operativo
- **Windows 10/11** (64-bit)
- **macOS** (Intel o Apple Silicon)
- **Linux** (Ubuntu 20.04+ o similar)

#### 2. Software a Instalar
- Node.js 18.x o superior
- Docker Desktop
- Git
- Editor de cÃ³digo (VS Code recomendado)

---

### ğŸš€ PASO A PASO: INSTALACIÃ“N COMPLETA

#### **PASO 1: Instalar Node.js**

##### Windows:
1. Ir a: https://nodejs.org/
2. Descargar el instalador LTS (Long Term Support)
3. Ejecutar el instalador y seguir los pasos
4. Verificar instalaciÃ³n:
   ```bash
   node --version    # Debe mostrar v18.x.x o superior
   npm --version     # Debe mostrar 9.x.x o superior
   ```

##### macOS:
```bash
# Usando Homebrew (recomendado)
brew install node@18

# Verificar
node --version
npm --version
```

##### Linux (Ubuntu/Debian):
```bash
# Instalar Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# Verificar
node --version
npm --version
```

---

#### **PASO 2: Instalar Docker Desktop**

##### Windows:
1. **Requisitos previos:**
   - Windows 10/11 Pro, Enterprise, o Education (con Hyper-V)
   - O Windows 10/11 Home (con WSL 2)
   - VirtualizaciÃ³n habilitada en BIOS

2. **Descargar Docker Desktop:**
   - Ir a: https://www.docker.com/products/docker-desktop/
   - Descargar "Docker Desktop for Windows"
   - Ejecutar el instalador `Docker Desktop Installer.exe`

3. **ConfiguraciÃ³n inicial:**
   - Durante la instalaciÃ³n, marcar "Use WSL 2 instead of Hyper-V"
   - Reiniciar la computadora cuando se solicite

4. **Iniciar Docker Desktop:**
   - Abrir "Docker Desktop" desde el menÃº inicio
   - Esperar a que el Ã­cono en la barra de tareas muestre "Docker Desktop is running"
   - Aceptar los tÃ©rminos de servicio

5. **Verificar instalaciÃ³n:**
   ```bash
   docker --version          # Debe mostrar Docker version 24.x.x
   docker compose version    # Debe mostrar Docker Compose version v2.x.x
   ```

##### macOS:
1. **Descargar Docker Desktop:**
   - Ir a: https://www.docker.com/products/docker-desktop/
   - Descargar "Docker Desktop for Mac" (Intel o Apple Silicon segÃºn tu Mac)

2. **Instalar:**
   - Abrir el archivo `.dmg` descargado
   - Arrastrar Docker a la carpeta Aplicaciones
   - Abrir Docker desde Aplicaciones
   - Dar permisos de administrador cuando se solicite

3. **Verificar:**
   ```bash
   docker --version
   docker compose version
   ```

##### Linux (Ubuntu):
```bash
# Actualizar paquetes
sudo apt-get update

# Instalar dependencias
sudo apt-get install -y \
    ca-certificates \
    curl \
    gnupg \
    lsb-release

# Agregar clave GPG oficial de Docker
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# Configurar repositorio
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# Instalar Docker Engine
sudo apt-get update
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# Agregar usuario al grupo docker (para usar sin sudo)
sudo usermod -aG docker $USER

# Reiniciar sesiÃ³n o ejecutar:
newgrp docker

# Verificar
docker --version
docker compose version
```

---

#### **PASO 3: Instalar Git**

##### Windows:
1. Descargar desde: https://git-scm.com/download/win
2. Ejecutar el instalador
3. ConfiguraciÃ³n recomendada durante instalaciÃ³n:
   - Editor: VS Code (o el que prefieras)
   - PATH: "Git from the command line and also from 3rd-party software"
   - Line endings: "Checkout Windows-style, commit Unix-style"

4. Verificar:
   ```bash
   git --version
   ```

##### macOS:
```bash
# Git suele venir preinstalado, si no:
brew install git

# Verificar
git --version
```

##### Linux:
```bash
sudo apt-get install git

# Verificar
git --version
```

---

#### **PASO 4: Clonar el Repositorio**

```bash
# Navegar a la carpeta donde quieres el proyecto
cd ~/Desktop  # O la ruta que prefieras

# Clonar el repositorio (reemplaza con tu URL de GitHub)
git clone https://github.com/TU_USUARIO/sistema-zarpar.git

# Entrar al directorio
cd sistema-zarpar

# Verificar que tienes todos los archivos
ls -la  # En Windows: dir
```

---

#### **PASO 5: Configurar Variables de Entorno**

```bash
# Crear archivo .env en la raÃ­z del proyecto
# En Windows PowerShell:
New-Item .env -ItemType File

# En macOS/Linux:
touch .env
```

**Contenido del archivo `.env`:**
```env
# Base de Datos (MySQL en Docker)
DB_HOST=localhost
DB_PORT=3307
DB_USER=root
DB_PASSWORD=zarpar2025
DB_NAME=zarparDataBase

# Backend
PORT=3456

# JWT Secret (para autenticaciÃ³n)
JWT_SECRET=tu_secreto_super_seguro_cambialo_en_produccion_zarpar2025

# Frontend (Vite)
VITE_API_URL=http://localhost:3456/api
```

**âš ï¸ IMPORTANTE:** Cambia `JWT_SECRET` por una cadena aleatoria segura en producciÃ³n.

---

#### **PASO 6: Levantar MySQL con Docker**

```bash
# Asegurarse de que Docker Desktop estÃ¡ corriendo
docker ps  # Debe responder sin errores

# Crear y levantar el contenedor de MySQL
docker run -d \
  --name zarpar-mysql \
  -e MYSQL_ROOT_PASSWORD=zarpar2025 \
  -e MYSQL_DATABASE=zarparDataBase \
  -p 3307:3306 \
  --restart unless-stopped \
  mysql:8.0

# Verificar que el contenedor estÃ¡ corriendo
docker ps | grep zarpar-mysql

# Ver logs del contenedor (opcional)
docker logs zarpar-mysql
```

**En Windows PowerShell, el comando es:**
```powershell
docker run -d `
  --name zarpar-mysql `
  -e MYSQL_ROOT_PASSWORD=zarpar2025 `
  -e MYSQL_DATABASE=zarparDataBase `
  -p 3307:3306 `
  --restart unless-stopped `
  mysql:8.0
```

**Esperar 20-30 segundos** para que MySQL termine de inicializarse.

---

#### **PASO 7: Restaurar la Base de Datos**

```bash
# Importar el backup completo a la base de datos
docker exec -i zarpar-mysql mysql -u root -pzarpar2025 < database/backup_completo.sql

# Verificar que se importÃ³ correctamente
docker exec -i zarpar-mysql mysql -u root -pzarpar2025 -e "USE zarparDataBase; SHOW TABLES;"
```

**DeberÃ­as ver tablas como:**
- `categorias_productos`
- `clientes_maldonado`
- `clientes_pando`
- `clientes_rivera`
- `productos`
- `productos_sucursal`
- `vendedores`
- ... y mÃ¡s

---

#### **PASO 8: Instalar Dependencias del Proyecto**

```bash
# Instalar todas las dependencias de Node.js
npm install

# Esto instalarÃ¡:
# - Dependencias del frontend (React, Vite, Ant Design, etc.)
# - Dependencias del backend (Express, MySQL2, JWT, etc.)
# - Herramientas de desarrollo (TypeScript, ESLint, etc.)
```

**â±ï¸ Este paso puede tardar 2-5 minutos** dependiendo de tu conexiÃ³n a internet.

---

#### **PASO 9: Levantar el Proyecto**

##### OpciÃ³n A: Usando el script automÃ¡tico (Windows)

```bash
# Ejecutar el archivo START.bat
./START.bat
```

Este script levanta automÃ¡ticamente:
- Frontend en puerto `5678`
- Backend en puerto `3456`

##### OpciÃ³n B: Manual (Para ver logs separados)

**Terminal 1 - Backend:**
```bash
npm run dev:api
```

**Terminal 2 - Frontend:**
```bash
npm run dev
```

##### OpciÃ³n C: Usando PowerShell Scripts (Windows)

```powershell
# Backend
./start-backend.ps1

# Frontend (en otra terminal)
./start-frontend.ps1
```

---

#### **PASO 10: Verificar que Todo Funciona**

1. **Frontend:** Abrir navegador en http://localhost:5678
   - DeberÃ­as ver la pÃ¡gina de login del Sistema Zarpar

2. **Backend:** Verificar en http://localhost:3456/api
   - DeberÃ­as ver un mensaje JSON

3. **Base de Datos:** Verificar conexiÃ³n
   ```bash
   docker exec -i zarpar-mysql mysql -u root -pzarpar2025 -e "SELECT COUNT(*) as total_vendedores FROM zarparDataBase.vendedores;"
   ```

---

#### **PASO 11: Iniciar SesiÃ³n**

**Credenciales disponibles:**

| Usuario | Email | ContraseÃ±a | Permisos |
|---------|-------|------------|----------|
| **Administrador** | admin@zarparuy.com | admin123 | âœ… Acceso total a todas las sucursales |
| Pando | pando@zarparuy.com | pando123 | âŒ Solo sucursal Pando |
| Maldonado | maldonado@zarparuy.com | maldonado123 | âŒ Solo sucursal Maldonado |
| Rivera | rivera@zarparuy.com | rivera123 | âŒ Solo sucursal Rivera |
| Melo | melo@zarparuy.com | melo123 | âŒ Solo sucursal Melo |
| PaysandÃº | paysandu@zarparuy.com | paysandu123 | âŒ Solo sucursal PaysandÃº |
| Salto | salto@zarparuy.com | salto123 | âŒ Solo sucursal Salto |
| TacuarembÃ³ | tacuarembo@zarparuy.com | tacuarembo123 | âŒ Solo sucursal TacuarembÃ³ |

**RecomendaciÃ³n:** Usa `admin@zarparuy.com` / `admin123` para tener acceso completo.

---

### ğŸ”§ SOLUCIÃ“N DE PROBLEMAS COMUNES

#### âŒ Error: "Docker daemon is not running"
**SoluciÃ³n:**
- Abrir Docker Desktop manualmente
- Esperar a que el Ã­cono muestre "Docker Desktop is running"
- Reintentar el comando

#### âŒ Error: "Port 3307 is already in use"
**SoluciÃ³n:**
```bash
# Ver quÃ© proceso usa el puerto
# Windows:
netstat -ano | findstr :3307

# macOS/Linux:
lsof -i :3307

# OpciÃ³n 1: Detener el otro contenedor
docker stop $(docker ps -q --filter "publish=3307")

# OpciÃ³n 2: Usar otro puerto (cambiar en .env y docker run)
```

#### âŒ Error: "Cannot connect to MySQL"
**SoluciÃ³n:**
```bash
# Verificar que el contenedor estÃ¡ corriendo
docker ps | grep zarpar-mysql

# Ver logs para errores
docker logs zarpar-mysql

# Reiniciar contenedor
docker restart zarpar-mysql

# Esperar 30 segundos y reintentar
```

#### âŒ Error: "Module not found" o errores de TypeScript
**SoluciÃ³n:**
```bash
# Limpiar cache y reinstalar
rm -rf node_modules package-lock.json
npm install

# En Windows:
Remove-Item -Recurse -Force node_modules, package-lock.json
npm install
```

#### âŒ Error: "EACCES: permission denied" (Linux/macOS)
**SoluciÃ³n:**
```bash
# Cambiar permisos del directorio
sudo chown -R $USER:$USER .

# O usar npm con usuario actual
npm config set prefix ~/.npm-global
export PATH=~/.npm-global/bin:$PATH
```

---

### ğŸ“‹ CHECKLIST DE VERIFICACIÃ“N

Antes de considerar que el proyecto estÃ¡ completamente instalado:

```
[ ] Node.js instalado (v18+)
[ ] Docker Desktop instalado y corriendo
[ ] Git instalado
[ ] Repositorio clonado
[ ] Archivo .env creado con las variables correctas
[ ] Contenedor MySQL corriendo (docker ps muestra zarpar-mysql)
[ ] Base de datos importada (SHOW TABLES muestra tablas)
[ ] Dependencias instaladas (node_modules existe)
[ ] Backend corriendo en http://localhost:3456
[ ] Frontend corriendo en http://localhost:5678
[ ] Login funciona con admin@zarparuy.com / admin123
[ ] Puedes navegar por el sistema sin errores
```

---

### ğŸ“ COMANDOS ÃšTILES DE MANTENIMIENTO

#### Reiniciar todo el sistema
```bash
# Detener todo
docker stop zarpar-mysql
# Matar procesos de Node (Ctrl+C en las terminales)

# Iniciar todo de nuevo
docker start zarpar-mysql
npm run dev
```

#### Ver logs del backend
```bash
# Los logs se muestran en la terminal donde ejecutaste npm run dev:api
```

#### Ver logs de MySQL
```bash
docker logs zarpar-mysql
docker logs -f zarpar-mysql  # Seguir logs en tiempo real
```

#### Hacer backup de la base de datos
```bash
docker exec zarpar-mysql mysqldump -u root -pzarpar2025 zarparDataBase > backup_$(date +%Y%m%d).sql
```

#### Restaurar un backup
```bash
docker exec -i zarpar-mysql mysql -u root -pzarpar2025 zarparDataBase < backup_20251029.sql
```

#### Actualizar el proyecto desde GitHub
```bash
git pull origin main
npm install  # Por si hay nuevas dependencias
```

---

### ğŸŒ URLS DEL SISTEMA

| Servicio | URL | DescripciÃ³n |
|----------|-----|-------------|
| **Frontend** | http://localhost:5678 | Interfaz de usuario principal |
| **Login** | http://localhost:5678/login | PÃ¡gina de inicio de sesiÃ³n |
| **Dashboard** | http://localhost:5678/dashboard | Panel principal |
| **POS** | http://localhost:5678/pos | Punto de Venta |
| **Productos** | http://localhost:5678/products | GestiÃ³n de productos |
| **Admin DB** | http://localhost:5678/admin/database | Administrador de base de datos |
| **Backend API** | http://localhost:3456/api | API REST del backend |
| **MySQL** | localhost:3307 | Base de datos (usar MySQL Workbench o similar) |

---

### ğŸ“š DOCUMENTACIÃ“N ADICIONAL

Archivos de documentaciÃ³n incluidos en el proyecto:

- `CONTEXTO_AGENTE.md` â†’ **Este archivo** - Contexto completo para el agente IA
- `COMO_FUNCIONA_PRODUCTOS_EXPLICACION_VISUAL.md` â†’ CÃ³mo funciona el sistema de productos
- `ANALISIS_ESTRUCTURA_PRODUCTOS_Y_STOCK.md` â†’ AnÃ¡lisis de la base de datos
- `README.md` â†’ DocumentaciÃ³n general del proyecto

---

## ğŸ¯ REGLA #1: BASE DE DATOS - NUNCA CAMBIAR

### ğŸ³ MySQL con Docker

**IMPORTANTE:** Este proyecto usa **Docker** para MySQL.

#### InformaciÃ³n del Contenedor:
```
Nombre del contenedor: zarpar-mysql
Imagen: mysql:8.0
Puerto expuesto: 3307 (host) â†’ 3306 (contenedor)
```

#### Verificar que Docker estÃ¡ corriendo:
```bash
# Ver contenedores activos
docker ps

# DeberÃ­as ver algo como:
# CONTAINER ID   IMAGE        PORTS                    NAMES
# fd8027103378   mysql:8.0    3307:3306/tcp           zarpar-mysql
```

#### Si el contenedor NO estÃ¡ corriendo:
```bash
# Iniciar el contenedor
docker start zarpar-mysql

# O iniciarlo y ver logs
docker start zarpar-mysql && docker logs -f zarpar-mysql
```

### ConexiÃ³n MySQL
```env
DB_HOST=localhost
DB_PORT=3307
DB_USER=root
DB_PASSWORD=zarpar2025
DB_NAME=zarparDataBase
```

### Comandos para Levantar el Proyecto
```bash
# 1. PRIMERO: AsegÃºrate de que Docker Desktop estÃ¡ corriendo
# 2. SEGUNDO: Verifica que el contenedor zarpar-mysql estÃ¡ activo (docker ps)
# 3. TERCERO: Inicia el proyecto

npm run dev

# Frontend: http://localhost:5678
# Backend: http://localhost:3456
# MySQL: localhost:3307 (Docker)
```

### ğŸ”§ Comandos Ãºtiles de Docker para MySQL

```bash
# Ver logs del contenedor MySQL
docker logs zarpar-mysql

# Acceder a MySQL desde terminal (dentro del contenedor)
docker exec -it zarpar-mysql mysql -u root -pzarpar2025

# Ver el estado del contenedor
docker ps -a | grep zarpar-mysql

# Reiniciar el contenedor (si hay problemas)
docker restart zarpar-mysql

# Ejecutar SQL desde archivo
docker exec -i zarpar-mysql mysql -u root -pzarpar2025 zarparDataBase < archivo.sql
```

### âš ï¸ NUNCA, BAJO NINGUNA CIRCUNSTANCIA:
- âŒ Cambiar el puerto `5678` del frontend
- âŒ Cambiar el puerto `3456` del backend
- âŒ Cambiar el puerto `3307` de MySQL (Docker)
- âŒ Modificar las credenciales de la base de datos
- âŒ Crear una nueva base de datos
- âŒ Cambiar el nombre `zarparDataBase`
- âŒ Detener o eliminar el contenedor `zarpar-mysql` sin backup
- âŒ Cambiar el nombre del contenedor Docker

---

## ğŸ” REGLA #2: ANTES DE HACER CUALQUIER CAMBIO

### Proceso OBLIGATORIO:

1. **LEER** todos los archivos relacionados
2. **REVISAR** todas las funciones que usan la base de datos
3. **IDENTIFICAR** quÃ© componentes se verÃ¡n afectados
4. **VERIFICAR** que no romperÃ¡s nada existente
5. **PLANIFICAR** el cambio sin afectar cÃ³digo funcional
6. **APLICAR** el cambio
7. **PROBAR** que todo sigue funcionando
8. **VERIFICAR** linter errors

### Archivos CrÃ­ticos a Revisar SIEMPRE:
```
api/config/database.ts          # ConfiguraciÃ³n DB
api/controllers/*                # Todos los controladores
api/routes/*                     # Todas las rutas
src/services/api.ts             # Servicios de frontend
src/pages/admin/DatabaseManager.tsx  # Admin de BD
```

### Si Algo se Rompe:
1. **DETENTE** inmediatamente
2. **REVIERTE** el cambio
3. **ANALIZA** el problema
4. **PROPÃ“N** una soluciÃ³n alternativa al usuario
5. **ESPERA** aprobaciÃ³n antes de continuar

---

## ğŸŒ REGLA #3: TODO EN ESPAÃ‘OL

### Aplicar en:
- âœ… Comentarios de cÃ³digo
- âœ… Nombres de variables (cuando sea lÃ³gico)
- âœ… Nombres de funciones descriptivas
- âœ… Mensajes de error y Ã©xito
- âœ… DocumentaciÃ³n
- âœ… Interfaces de usuario
- âœ… Logs de consola
- âœ… Respuestas al usuario

### Ejemplo de CÃ³digo:
```typescript
// âœ… CORRECTO
const cargarClientes = async () => {
  try {
    const respuesta = await obtenerClientesPorSucursal(sucursal);
    mensaje.success('Clientes cargados exitosamente');
  } catch (error) {
    mensaje.error('Error al cargar los clientes');
  }
};

// âŒ INCORRECTO (mezclar idiomas)
const loadClientes = async () => {
  const response = await getClientesPorSucursal(branch);
}
```

---

## ğŸ‘¨â€ğŸ“ REGLA #4: EL USUARIO ES PRINCIPIANTE

### Tratar al Usuario Como:
- ğŸ“ Estudiante que estÃ¡ aprendiendo
- ğŸ†• Principiante en programaciÃ³n
- ğŸ“š Alguien que quiere entender el "por quÃ©"

### SIEMPRE Hacer:
1. **EXPLICAR** cada cambio que hagas
2. **ENSEÃ‘AR** el concepto detrÃ¡s del cÃ³digo
3. **SIMPLIFICAR** tÃ©rminos tÃ©cnicos
4. **USAR** analogÃ­as del mundo real
5. **SUGERIR** mejoras y buenas prÃ¡cticas
6. **ANTICIPAR** problemas futuros
7. **DOCUMENTAR** con comentarios claros

### Ejemplo de Respuesta:
```
âŒ MAL: "AgreguÃ© un useEffect con dependencies array"

âœ… BIEN: 
"AgreguÃ© un useEffect (una funciÃ³n que se ejecuta automÃ¡ticamente 
cuando carga el componente). Esto es como tener un ayudante que 
siempre verifica si algo cambiÃ³ y actualiza la informaciÃ³n. 
En este caso, cada vez que cambies de sucursal, automÃ¡ticamente 
traerÃ¡ los clientes de esa sucursal."
```

### Actuar Como:
- ğŸ’¡ **Ingeniero Senior** que revisa y optimiza el cÃ³digo
- ğŸ¯ **Mentor** que enseÃ±a y explica
- ğŸ” **QA Tester** que encuentra posibles problemas
- ğŸ—ï¸ **Arquitecto** que sugiere mejores soluciones

---

## ğŸ¢ REGLA #5: SISTEMA DE SUCURSALES Y ROLES

### ğŸ‘‘ USUARIO ADMINISTRADOR (ACCESO TOTAL)

**â­ ÃšNICO USUARIO CON ACCESO A TODO:**

| Rol              | Email                | Acceso                           | Sucursal      |
|------------------|----------------------|----------------------------------|---------------|
| **Administrador**| admin@zarparuy.com   | TODAS las tablas de clientes     | Administracion|
|                  |                      | TODAS las sucursales             |               |
|                  |                      | Vendedores de todas las sucursales|              |

**CaracterÃ­sticas del Admin:**
- âœ… Puede ver `clientes_pando`, `clientes_maldonado`, `clientes_rivera`, etc. (TODAS)
- âœ… Puede gestionar vendedores de cualquier sucursal
- âœ… Tiene permisos de lectura/escritura en toda la base de datos
- âœ… Puede generar reportes consolidados de todas las sucursales
- âœ… Es el ÃšNICO usuario con estos privilegios
- âœ… EstÃ¡ en la tabla `vendedores` con cargo "Administrador" o "Director General"
- âœ… **PRODUCTOS**: Puede crear, editar, actualizar stock y precios en `/products`
- âœ… **PRODUCTOS**: Ve botones de acciones (editar, actualizar stock/precio)

### âš ï¸ IMPORTANTE: "ADMINISTRADOR" NO ES UNA SUCURSAL

**ğŸš¨ REGLA CRÃTICA:**

| Concepto | DescripciÃ³n | Uso |
|----------|-------------|-----|
| **"Administrador"** | Es un ROL, NO una sucursal fÃ­sica | âŒ NO usar en selectores de sucursales |
| | Es el puesto del gerente general | âŒ NO tiene tabla de clientes |
| | Tiene acceso a TODAS las sucursales | âœ… Puede seleccionar cualquier sucursal real |
| | Email: admin@zarparuy.com | âœ… Se identifica por email, no por sucursal |

**En cÃ³digo, SIEMPRE:**
```typescript
// âŒ MAL - Tratar "Administrador" como sucursal
const sucursales = ['Pando', 'Maldonado', 'Administrador'];

// âœ… BIEN - Filtrar "Administrador" de las sucursales
const sucursales = ['Pando', 'Maldonado', 'Rivera', ...].filter(
  s => s.toLowerCase() !== 'administrador'
);

// âœ… BIEN - Identificar admin por email, no por sucursal
if (usuario.email === 'admin@zarparuy.com') {
  // Dar acceso a todas las sucursales
}
```

**Cuando listar sucursales:**
- âŒ NO incluir "Administrador", "Administracion", "Admin"
- âœ… SOLO listar sucursales fÃ­sicas: Pando, Maldonado, Rivera, Melo, PaysandÃº, Salto, TacuarembÃ³
- âœ… El admin puede SELECCIONAR entre estas sucursales, pero su rol no es una de ellas

### ğŸ‘¥ USUARIOS POR SUCURSAL (ACCESO LIMITADO)

**7 Sucursales con acceso restringido:**

| Sucursal    | Email                    | Tabla de Clientes       | Acceso                    |
|-------------|--------------------------|-------------------------|---------------------------|
| Pando       | pando@zarparuy.com       | clientes_pando          | SOLO Pando                |
| Maldonado   | maldonado@zarparuy.com   | clientes_maldonado      | SOLO Maldonado            |
| Rivera      | rivera@zarparuy.com      | clientes_rivera         | SOLO Rivera               |
| Melo        | melo@zarparuy.com        | clientes_melo           | SOLO Melo                 |
| PaysandÃº    | paysandu@zarparuy.com    | clientes_paysandu       | SOLO PaysandÃº             |
| Salto       | salto@zarparuy.com       | clientes_salto          | SOLO Salto                |
| TacuarembÃ³  | tacuarembo@zarparuy.com  | clientes_tacuarembo     | SOLO TacuarembÃ³           |

**Restricciones de Usuarios de Sucursal:**
- âŒ **PRODUCTOS**: NO pueden crear productos en `/products`
- âŒ **PRODUCTOS**: NO pueden editar productos
- âŒ **PRODUCTOS**: NO pueden actualizar stock ni precios
- âœ… **PRODUCTOS**: SOLO pueden VER productos (modo lectura)
- âŒ **PRODUCTOS**: NO ven botones de acciones (sin editar, sin actualizar stock/precio)

### Reglas de RelaciÃ³n:

#### 1. Usuario â†’ Sucursal â†’ Clientes

**ğŸ”´ CASO ESPECIAL - ADMINISTRADOR:**
```
admin@zarparuy.com â†’ TODAS las sucursales â†’ TODAS las tablas de clientes
â”œâ”€ clientes_pando
â”œâ”€ clientes_maldonado
â”œâ”€ clientes_rivera
â”œâ”€ clientes_melo
â”œâ”€ clientes_paysandu
â”œâ”€ clientes_salto
â””â”€ clientes_tacuarembo
```

**ğŸŸ¢ CASO NORMAL - USUARIOS POR SUCURSAL (1:1):**
- Cada email estÃ¡ asociado a UNA sucursal especÃ­fica
- `pando@zarparuy.com` â†’ SOLO puede acceder a sucursal Pando â†’ SOLO `clientes_pando`
- `maldonado@zarparuy.com` â†’ SOLO puede acceder a sucursal Maldonado â†’ SOLO `clientes_maldonado`
- Y asÃ­ sucesivamente...

#### 2. Sucursal â†’ Clientes (1:N)
- Cada sucursal tiene su PROPIA tabla de clientes
- Los clientes de Pando estÃ¡n en `clientes_pando`
- Los clientes de Maldonado estÃ¡n en `clientes_maldonado`
- **EXCEPCIÃ“N**: Admin ve todas las tablas de clientes

#### 3. Sucursal â†’ Vendedores (1:N)
- Cada sucursal tiene sus propios vendedores
- Los vendedores estÃ¡n en la tabla `vendedores`
- Filtrados por el campo `sucursal`
- **EXCEPCIÃ“N**: Admin puede ver vendedores de todas las sucursales

### Mapeo AutomÃ¡tico (SIEMPRE APLICAR):

```typescript
// FunciÃ³n de mapeo que SIEMPRE debes usar
const obtenerTablaClientes = (
  sucursal: string, 
  email?: string
): string | string[] => {
  
  // â­ CASO ESPECIAL: Administrador puede ver TODAS
  if (email === 'admin@zarparuy.com') {
    return [
      'clientes_pando',
      'clientes_maldonado',
      'clientes_rivera',
      'clientes_melo',
      'clientes_paysandu',
      'clientes_salto',
      'clientes_tacuarembo'
    ];
  }
  
  // ğŸ”¹ CASO NORMAL: Mapeo por sucursal
  const mapeo = {
    'pando': 'clientes_pando',
    'maldonado': 'clientes_maldonado',
    'rivera': 'clientes_rivera',
    'melo': 'clientes_melo',
    'paysandu': 'clientes_paysandu',
    'salto': 'clientes_salto',
    'tacuarembo': 'clientes_tacuarembo'
  };
  return mapeo[sucursal.toLowerCase()] || 'clientes_pando';
};

// FunciÃ³n para verificar si es administrador
const esAdministrador = (email: string): boolean => {
  return email === 'admin@zarparuy.com';
};

// FunciÃ³n para verificar permisos de acceso
const tieneAccesoASucursal = (
  email: string, 
  sucursal: string
): boolean => {
  // Admin tiene acceso a todo
  if (esAdministrador(email)) {
    return true;
  }
  
  // Usuario normal solo a su sucursal
  const emailALowerCase = email.toLowerCase();
  const sucursalALowerCase = sucursal.toLowerCase();
  
  return emailALowerCase.startsWith(sucursalALowerCase);
};
```

### Sistema de Login (IMPLEMENTAR EN FUTURO):

```
Usuario se logea â†’ Identifica email â†’ Verifica si es Admin â†’ 
Extrae sucursal o da acceso total â†’ Guarda en sesiÃ³n â†’ 
Filtra datos segÃºn permisos
```

#### Ejemplo de Flujo NORMAL:
1. Usuario ingresa: `pando@zarparuy.com`
2. Sistema verifica: NO es admin
3. Sistema identifica: Sucursal = "Pando"
4. Sistema carga: `clientes_pando`
5. Usuario SOLO ve clientes de Pando
6. Usuario SOLO ve vendedores de Pando

#### Ejemplo de Flujo ADMINISTRADOR:
1. Usuario ingresa: `admin@zarparuy.com`
2. Sistema verifica: âœ… ES ADMINISTRADOR
3. Sistema da acceso: TODAS las sucursales
4. Sistema carga: TODAS las tablas de clientes
5. Admin ve: Selector de sucursales para filtrar O ver todas juntas
6. Admin ve: TODOS los vendedores de TODAS las sucursales

### âš ï¸ IMPORTANTE:
- Cada sucursal es INDEPENDIENTE (excepto para admin)
- NO mezclar datos entre sucursales (excepto admin que puede verlas todas)
- Validar SIEMPRE la sucursal antes de queries
- Proteger rutas por sucursal Y verificar rol
- **SIEMPRE** verificar si el usuario es `admin@zarparuy.com` antes de filtrar
- Si es admin â†’ acceso total
- Si NO es admin â†’ acceso solo a su sucursal

### ğŸ” LÃ³gica de Permisos a Implementar:

```typescript
// En cada endpoint que accede a clientes
const obtenerClientes = async (req, res) => {
  const userEmail = req.user.email; // Del token JWT
  const sucursalSolicitada = req.params.sucursal;
  
  // â­ Si es admin, permitir acceso a cualquier sucursal
  if (userEmail === 'admin@zarparuy.com') {
    // Admin puede solicitar cualquier sucursal o todas
    if (sucursalSolicitada === 'todas') {
      // Retornar clientes de todas las sucursales
      return await obtenerTodosLosClientes();
    } else {
      // Retornar clientes de la sucursal especÃ­fica
      return await obtenerClientesDeSucursal(sucursalSolicitada);
    }
  }
  
  // ğŸ”¹ Usuario normal: solo su sucursal
  const sucursalDelUsuario = extraerSucursalDelEmail(userEmail);
  
  // Validar que solo acceda a su sucursal
  if (sucursalSolicitada !== sucursalDelUsuario) {
    return res.status(403).json({ 
      error: 'No tienes permiso para acceder a esta sucursal' 
    });
  }
  
  return await obtenerClientesDeSucursal(sucursalDelUsuario);
};
```

---

## ğŸ—„ï¸ REGLA #6: OPTIMIZACIÃ“N DE BASE DE DATOS

### FilosofÃ­a: MENOS es MÃS

#### Antes de Crear una Tabla Nueva:
1. Â¿Puedo agregar columnas a una tabla existente? â†’ **PREFIERE ESTO**
2. Â¿Es necesario por performance? â†’ Considera crear tabla
3. Â¿Es necesario por seguridad? â†’ Considera crear tabla
4. Â¿Es necesario por escalabilidad? â†’ Considera crear tabla

#### Principios de DiseÃ±o:

**âœ… BUENAS PRÃCTICAS:**
- Reutilizar tablas existentes agregando columnas
- Normalizar datos (evitar redundancia)
- Usar Ã­ndices en columnas frecuentemente consultadas
- Usar foreign keys para relaciones
- Nombres descriptivos en espaÃ±ol o inglÃ©s consistente

**âŒ MALAS PRÃCTICAS:**
- Crear tabla para cada cosa pequeÃ±a
- Duplicar informaciÃ³n
- Tablas con 2-3 columnas cuando pueden estar en otra
- Nombres confusos o inconsistentes

#### Consultar ANTES de:
- Crear nueva tabla
- Modificar estructura existente
- Eliminar columnas con datos

#### Ejemplo de Pensamiento:

```
Usuario pide: "Quiero guardar el color favorito del cliente"

âŒ MAL: Crear tabla "colores_favoritos"
âœ… BIEN: Agregar columna "color_favorito" a tabla de clientes

Usuario pide: "Quiero historial de compras del cliente"

âŒ MAL: Agregar 100 columnas "compra_1", "compra_2"... 
âœ… BIEN: Crear tabla "compras" relacionada con "clientes"
```

---

## ğŸ“š REGLA #7: EXPLICAR TODO (ENSEÃ‘AR)

### Template de ExplicaciÃ³n:

```markdown
## ğŸ”§ Lo que hice:
[DescripciÃ³n breve en espaÃ±ol simple]

## ğŸ¤” Â¿Por quÃ©?
[RazÃ³n tÃ©cnica explicada de forma simple]

## ğŸ“– Â¿CÃ³mo funciona?
[AnalogÃ­a del mundo real + explicaciÃ³n tÃ©cnica]

## ğŸ’¡ Conceptos que aprendiste:
- Concepto 1: explicaciÃ³n
- Concepto 2: explicaciÃ³n

## ğŸš€ Beneficios:
- Beneficio 1
- Beneficio 2

## âš ï¸ Cuidados:
[Si hay algo que tener en cuenta]
```

### Ejemplo Real:

```markdown
## ğŸ”§ Lo que hice:
AgreguÃ© un useEffect que carga los clientes automÃ¡ticamente

## ğŸ¤” Â¿Por quÃ©?
Porque cada vez que cambias de sucursal, necesitas ver los 
clientes diferentes. Sin esto, tendrÃ­as que refrescar la pÃ¡gina.

## ğŸ“– Â¿CÃ³mo funciona?
Imagina que tienes un sensor de movimiento en tu casa. Cuando 
detecta que entraste, automÃ¡ticamente enciende las luces. 
useEffect es como ese sensor: detecta cuando cambiÃ³ la sucursal 
y automÃ¡ticamente carga los clientes nuevos.

## ğŸ’¡ Conceptos que aprendiste:
- useEffect: Hook que ejecuta cÃ³digo cuando algo cambia
- Dependencies: Lista de cosas que "vigilamos"
- Side Effects: Acciones que afectan fuera del componente

## ğŸš€ Beneficios:
- ActualizaciÃ³n automÃ¡tica
- Mejor experiencia de usuario
- CÃ³digo mÃ¡s limpio y organizado
```

---

## ğŸ› REGLA #8: CERO BUGS, CERO PROBLEMAS

### FilosofÃ­a: "MÃ¡s vale prevenir que lamentar"

#### Antes de Cada Cambio:

**Checklist OBLIGATORIO:**
```
[ ] LeÃ­ el cÃ³digo existente
[ ] EntendÃ­ cÃ³mo funciona actualmente
[ ] IdentifiquÃ© quÃ© archivos se afectarÃ¡n
[ ] VerifiquÃ© que no hay dependencias ocultas
[ ] PlanifiquÃ© el cambio sin romper nada
[ ] Tengo un plan B si algo falla
```

#### DespuÃ©s de Cada Cambio:

**Checklist OBLIGATORIO:**
```
[ ] El cÃ³digo compila sin errores
[ ] No hay linter errors
[ ] ProbÃ© la funcionalidad manualmente (si es posible)
[ ] No rompÃ­ ninguna funcionalidad existente
[ ] AgreguÃ© comentarios explicativos
[ ] ActualicÃ© tipos de TypeScript si es necesario
```

#### Si Encuentras un Bug:

1. **NO LO IGNORES** - Nunca dejes un bug sin resolver
2. **ANALIZA LA CAUSA RAÃZ** - No solo los sÃ­ntomas
3. **PROPÃ“N SOLUCIÃ“N** - Explica quÃ© harÃ¡s
4. **IMPLEMENTA CON CUIDADO** - Sin crear nuevos bugs
5. **VERIFICA TODO** - Asegura que se solucionÃ³

#### PrevenciÃ³n de Bugs:

**âœ… HACER:**
- Validar TODOS los inputs
- Manejar TODOS los casos de error
- Usar try-catch en operaciones async
- Agregar tipos de TypeScript
- Comentar cÃ³digo complejo
- Probar casos extremos

**âŒ NO HACER:**
- Asumir que los datos son correctos
- Ignorar warnings
- Dejar console.log en producciÃ³n (algunos sÃ­)
- Hacer cambios "rÃ¡pidos" sin pensar
- Copiar cÃ³digo sin entender

---

## ğŸ¨ REGLA #9: INTERFAZ PROFESIONAL Y RESPONSIVE

### Principios de DiseÃ±o:

#### 1. Responsive 100%
```typescript
// SIEMPRE usar breakpoints de Ant Design
<Row gutter={[16, 16]}>
  <Col xs={24} sm={12} md={8} lg={6} xl={4}>
    {/* Contenido */}
  </Col>
</Row>

// xs: mÃ³viles (< 576px) - Full width
// sm: tablets pequeÃ±as (â‰¥ 576px)
// md: tablets (â‰¥ 768px)
// lg: desktop (â‰¥ 992px)
// xl: pantallas grandes (â‰¥ 1200px)
```

#### 2. Iconos Elegantes (Ant Design Icons)
```typescript
import {
  DashboardOutlined,    // Para dashboard
  UserOutlined,         // Para usuarios
  ShoppingOutlined,     // Para ventas
  DatabaseOutlined,     // Para BD
  // etc... SIEMPRE usar iconos semÃ¡nticos
} from '@ant-design/icons';
```

#### 3. Animaciones Suaves
```typescript
// En CSS/Inline styles
transition: 'all 0.3s ease'

// Para hover effects
style={{
  transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
  transform: hover ? 'translateY(-4px)' : 'translateY(0)',
  boxShadow: hover ? '0 12px 24px rgba(0,0,0,0.15)' : '0 2px 8px rgba(0,0,0,0.1)'
}}
```

#### 4. Efectos Hover Profesionales
```css
.card {
  transition: all 0.3s ease;
  cursor: pointer;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
}

.button:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}
```

#### 5. Paleta de Colores Consistente
```typescript
const COLORS = {
  primary: '#3b82f6',      // Azul principal
  success: '#10b981',      // Verde Ã©xito
  warning: '#f59e0b',      // Amarillo advertencia
  danger: '#ef4444',       // Rojo peligro
  info: '#8b5cf6',         // Morado info
  gray: {
    50: '#f9fafb',
    100: '#f3f4f6',
    // ... etc
  }
};
```

#### 6. Loading States Elegantes
```typescript
// SIEMPRE mostrar feedback visual
<Button loading={isLoading} icon={<SaveOutlined />}>
  Guardar
</Button>

<Spin spinning={loading} tip="Cargando datos...">
  {contenido}
</Spin>
```

#### 7. Mensajes y Feedback
```typescript
// Usar el sistema de mensajes de Ant Design
message.success('âœ… OperaciÃ³n exitosa');
message.error('âŒ Error al procesar');
message.warning('âš ï¸ Revisa los datos');
message.info('â„¹ï¸ InformaciÃ³n importante');
```

### Componentes que SIEMPRE Deben Ser Responsive:

- âœ… Tablas (scroll horizontal en mÃ³vil)
- âœ… Formularios (columna Ãºnica en mÃ³vil)
- âœ… Cards (grid adaptativo)
- âœ… Modales (full screen en mÃ³vil)
- âœ… Sidebars (colapsable en mÃ³vil)
- âœ… EstadÃ­sticas (stack vertical en mÃ³vil)

---

## ğŸ”’ REGLA #10: SEGURIDAD MÃXIMA

### ProtecciÃ³n Contra SQL Injection:

#### âœ… SIEMPRE Usar Prepared Statements:
```typescript
// âœ… CORRECTO - ParÃ¡metros seguros
const query = 'SELECT * FROM `users` WHERE id = ?';
await pool.execute(query, [userId]);

// âœ… CORRECTO - MÃºltiples parÃ¡metros
const query = 'INSERT INTO `clientes` (nombre, email) VALUES (?, ?)';
await pool.execute(query, [nombre, email]);

// âŒ NUNCA HACER ESTO - Vulnerable a SQL Injection
const query = `SELECT * FROM users WHERE id = ${userId}`;
await pool.execute(query);

// âŒ NUNCA HACER ESTO - ConcatenaciÃ³n directa
const query = `SELECT * FROM users WHERE name = '${userName}'`;
```

#### âœ… SIEMPRE Escapar Nombres de Tabla/Columna:
```typescript
// âœ… CORRECTO - Backticks protegen
const query = `SELECT * FROM \`${tableName}\` WHERE \`${columnName}\` = ?`;

// âŒ INCORRECTO - Sin protecciÃ³n
const query = `SELECT * FROM ${tableName} WHERE ${columnName} = ?`;
```

### ValidaciÃ³n de Inputs:

```typescript
// SIEMPRE validar en Backend
const validarCliente = (data: any) => {
  // Validar campos requeridos
  if (!data.nombre || !data.email) {
    throw new Error('Campos requeridos faltantes');
  }
  
  // Validar formato de email
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(data.email)) {
    throw new Error('Email invÃ¡lido');
  }
  
  // Validar longitud
  if (data.nombre.length > 100) {
    throw new Error('Nombre muy largo');
  }
  
  // Sanitizar (limpiar caracteres peligrosos)
  data.nombre = data.nombre.trim();
  
  return data;
};
```

### ProtecciÃ³n de Rutas:

```typescript
// Middleware de autenticaciÃ³n
const verificarAutenticacion = (req, res, next) => {
  const token = req.headers.authorization;
  
  if (!token) {
    return res.status(401).json({ 
      error: 'No autorizado' 
    });
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(403).json({ 
      error: 'Token invÃ¡lido' 
    });
  }
};

// Aplicar a rutas protegidas
router.get('/clientes', verificarAutenticacion, obtenerClientes);
```

### Variables de Entorno Seguras:

```typescript
// âŒ NUNCA hardcodear secretos
const secret = 'mi-password-123';

// âœ… SIEMPRE usar variables de entorno
const secret = process.env.JWT_SECRET;

// âœ… SIEMPRE validar que existan
if (!process.env.JWT_SECRET) {
  throw new Error('JWT_SECRET no estÃ¡ configurado');
}
```

### Rate Limiting:

```typescript
// Proteger contra ataques de fuerza bruta
import rateLimit from 'express-rate-limit';

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutos
  max: 100, // mÃ¡ximo 100 requests
  message: 'Demasiadas solicitudes, intenta mÃ¡s tarde'
});

app.use('/api/', limiter);
```

### SanitizaciÃ³n de Datos:

```typescript
// Limpiar datos antes de guardar
const sanitizarInput = (input: string): string => {
  return input
    .trim()                    // Quitar espacios
    .replace(/[<>]/g, '')      // Quitar < >
    .slice(0, 500);            // Limitar longitud
};
```

### Headers de Seguridad:

```typescript
import helmet from 'helmet';

// Agregar headers de seguridad
app.use(helmet());

// Prevenir clickjacking
app.use(helmet.frameguard({ action: 'deny' }));

// Forzar HTTPS
app.use(helmet.hsts({
  maxAge: 31536000,
  includeSubDomains: true
}));
```

---

## ğŸ“‹ CHECKLIST PRE-RESPUESTA

Antes de enviar CUALQUIER respuesta al usuario:

```
[ ] LeÃ­ CONTEXTO_AGENTE.md
[ ] EntendÃ­ el request del usuario
[ ] RevisÃ© el cÃ³digo existente
[ ] PlanifiquÃ© sin romper nada
[ ] ConsiderÃ© todas las reglas (1-10)
[ ] PreparÃ© una explicaciÃ³n educativa
[ ] VerifiquÃ© seguridad
[ ] ConsiderÃ© el rol de admin@zarparuy.com
[ ] ValidÃ© permisos por sucursal
[ ] NUNCA trato "Administrador" como sucursal
[ ] FiltrÃ© "Administrador" de listas de sucursales
[ ] PensÃ© en responsive
[ ] Todo estÃ¡ en espaÃ±ol
[ ] Tengo una soluciÃ³n completa
```

---

## ğŸ¯ RESUMEN DE REGLAS

1. âœ… **Base de Datos**: localhost:3307, zarparDataBase, NUNCA cambiar
2. âœ… **Revisar CÃ³digo**: SIEMPRE antes de cambiar, NO romper nada
3. âœ… **EspaÃ±ol**: Todo en espaÃ±ol, comentarios, mensajes, UI
4. âœ… **EnseÃ±ar**: Usuario principiante, explicar TODO con ejemplos
5. âœ… **Sucursales**: 7 sucursales fÃ­sicas, "Administrador" NO es sucursal
   - ğŸš¨ **CRÃTICO**: "Administrador" es un ROL, no una sucursal
   - âŒ NUNCA incluir "Administrador" en selectores de sucursales
   - âœ… Admin (admin@zarparuy.com) puede ver TODAS las sucursales
6. âœ… **Optimizar BD**: Evitar tablas innecesarias, agregar columnas primero
7. âœ… **Explicar**: EnseÃ±ar el "por quÃ©" y "cÃ³mo" con analogÃ­as
8. âœ… **Sin Bugs**: Revisar TODO, prevenir problemas, solucionar BIEN
9. âœ… **UI Profesional**: 100% responsive, iconos, animaciones, hover
10. âœ… **Seguridad**: Prepared statements, validaciÃ³n, sanitizaciÃ³n

---

## ğŸš€ TECNOLOGÃAS DEL PROYECTO

- **Frontend**: React 18 + TypeScript + Vite + Ant Design 5
- **Backend**: Node.js + Express + TypeScript
- **Base de Datos**: MySQL 8.0
- **Puertos**: Frontend:5678, Backend:3456, MySQL:3307

---

---

## ğŸ†• REGLA #11: GESTIÃ“N DE VENDEDORES - ELIMINACIÃ“N INTELIGENTE

### ğŸ”„ Sistema Implementado: Hard Delete + Soft Delete Fallback

**IMPORTANTE**: El sistema de eliminaciÃ³n de vendedores usa una lÃ³gica inteligente que balancea la solicitud del usuario con la integridad de datos.

#### Flujo de EliminaciÃ³n:

```typescript
// 1. Usuario hace clic en "Eliminar" en StaffSellers.tsx
// 2. Frontend muestra advertencia FUERTE de eliminaciÃ³n permanente
// 3. Backend intenta HARD DELETE primero
// 4. Si falla por Foreign Key â†’ SOFT DELETE automÃ¡tico
```

#### CÃ³digo de Referencia (Backend):

**Archivo**: `api/controllers/vendedoresController.ts`

```typescript
export const eliminarVendedor = async (req, res) => {
  try {
    // Verificar que existe
    const vendedor = await buscarVendedor(id);
    
    // Intentar HARD DELETE primero
    try {
      await executeQuery('DELETE FROM vendedores WHERE id = ?', [id]);
      
      return res.json({
        success: true,
        message: 'Vendedor eliminado permanentemente',
        data: { eliminado_permanentemente: true }
      });
      
    } catch (deleteError) {
      // Si falla por Foreign Key Constraint
      if (deleteError.code === 'ER_ROW_IS_REFERENCED_2' || deleteError.errno === 1451) {
        
        // Fallback a SOFT DELETE
        await executeQuery(
          'UPDATE vendedores SET activo = 0 WHERE id = ?',
          [id]
        );
        
        return res.json({
          success: true,
          message: 'Vendedor desactivado (tiene datos relacionados)',
          data: { 
            eliminado_permanentemente: false,
            desactivado: true 
          }
        });
      }
      throw deleteError;
    }
  } catch (error) {
    // Error general
  }
};
```

#### Frontend - Advertencia Visual:

**Archivo**: `src/pages/staff/StaffSellers.tsx`

```typescript
<Popconfirm
  title="âš ï¸ Â¡ELIMINAR PERMANENTEMENTE!"
  description={
    <div>
      <p>Â¿EstÃ¡s seguro de eliminar a <strong>"{vendedor.nombre}"</strong>?</p>
      <Alert
        message="ADVERTENCIA: Esta acciÃ³n es IRREVERSIBLE"
        description="El vendedor serÃ¡ BORRADO PERMANENTEMENTE..."
        type="error"
        showIcon
      />
    </div>
  }
  onConfirm={() => handleEliminarVendedor(id)}
  okText="ğŸ—‘ï¸ SÃ, ELIMINAR PERMANENTEMENTE"
  cancelText="âŒ Cancelar"
/>
```

#### Mensajes de Feedback:

```typescript
// En handleEliminarVendedor (frontend)
if (response.data.data?.eliminado_permanentemente) {
  // âœ… Hard delete exitoso
  messageApi.success('ğŸ—‘ï¸ Vendedor eliminado permanentemente');
  
} else if (response.data.data?.desactivado) {
  // âš ï¸ Soft delete por Foreign Keys
  messageApi.warning(
    'âš ï¸ El vendedor tiene datos relacionados y fue desactivado'
  );
}
```

### ğŸ”— Foreign Key Constraints Detectadas:

Las siguientes tablas tienen relaciones con `vendedores`:

```sql
clientes_pando         â†’ vendedor_id (FK)
clientes_maldonado     â†’ vendedor_id (FK)
clientes_rivera        â†’ vendedor_id (FK)
clientes_melo          â†’ vendedor_id (FK)
clientes_paysandu      â†’ vendedor_id (FK)
clientes_salto         â†’ vendedor_id (FK)
clientes_tacuarembo    â†’ vendedor_id (FK)
```

**TOTAL**: 7 Foreign Keys

### âš ï¸ REGLAS PARA FUTUROS CAMBIOS:

1. **NUNCA** forzar eliminaciÃ³n con `ON DELETE CASCADE` sin consultar
2. **SIEMPRE** intentar hard delete primero
3. **SIEMPRE** hacer fallback a soft delete si hay relaciones
4. **SIEMPRE** informar al usuario quÃ© tipo de eliminaciÃ³n ocurriÃ³
5. **CONSIDERAR** crear una "papelera de reciclaje" para reactivar vendedores

### ğŸ¯ Casos de Uso:

#### Caso 1: Vendedor SIN clientes ni ventas
```
Usuario elimina â†’ Backend intenta DELETE â†’ âœ… Ã‰xito
Resultado: Vendedor ELIMINADO PERMANENTEMENTE
Mensaje: "ğŸ—‘ï¸ Vendedor eliminado permanentemente de la base de datos"
```

#### Caso 2: Vendedor CON clientes o ventas
```
Usuario elimina â†’ Backend intenta DELETE â†’ âŒ Error FK Constraint
â†’ Backend hace UPDATE activo = 0 â†’ âœ… Ã‰xito
Resultado: Vendedor DESACTIVADO (soft delete)
Mensaje: "âš ï¸ El vendedor tiene clientes o ventas asociadas. 
Se ha DESACTIVADO para preservar el historial."
```

### ğŸ” Seguridad y Permisos:

**Endpoints de Vendedores** (`api/routes/vendedores.ts`):

```typescript
// Todas las operaciones requieren autenticaciÃ³n
router.use(verificarAutenticacion);

// Solo admin puede crear/editar/eliminar
router.post('/', verificarAdmin, crearVendedor);
router.put('/:id', verificarAdmin, actualizarVendedor);
router.delete('/:id', verificarAdmin, eliminarVendedor);

// Todos pueden ver (filtrado por sucursal)
router.get('/', obtenerVendedores);
```

### ğŸ“Š Campos de la Tabla `vendedores`:

```sql
CREATE TABLE vendedores (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  apellido VARCHAR(100) NOT NULL,
  email VARCHAR(100) UNIQUE NOT NULL,
  telefono VARCHAR(20),
  cargo VARCHAR(50),
  sucursal VARCHAR(50) NOT NULL,
  activo TINYINT(1) DEFAULT 1,  -- âš ï¸ Campo para soft delete
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### ğŸ’¡ Mejoras Futuras Sugeridas:

1. **Papelera de Reciclaje**:
   - Vista de vendedores desactivados (activo = 0)
   - BotÃ³n "Reactivar" para restaurar vendedores
   - BotÃ³n "Eliminar permanentemente" desde papelera
   
2. **Historial de AuditorÃ­a**:
   - Tabla `vendedores_log` con:
     - QuiÃ©n eliminÃ³/desactivÃ³
     - CuÃ¡ndo
     - RazÃ³n
   
3. **VerificaciÃ³n Preventiva**:
   - Antes de mostrar el modal de eliminaciÃ³n
   - Consultar si tiene relaciones
   - Mostrar mensaje diferente segÃºn el caso

---

## ğŸ“š ARCHIVOS CRÃTICOS DEL PROYECTO

### Backend (API):
```
api/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ database.ts          # ConexiÃ³n MySQL con pool
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ vendedoresController.ts   # â­ CRUD de vendedores (eliminaciÃ³n inteligente)
â”‚   â”œâ”€â”€ clientesController.ts     # GestiÃ³n de clientes
â”‚   â””â”€â”€ productosController.ts    # GestiÃ³n de productos
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ vendedores.ts        # â­ Rutas de vendedores (protegidas)
â”‚   â”œâ”€â”€ clientes.ts          # Rutas de clientes
â”‚   â””â”€â”€ productos.ts         # Rutas de productos
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.ts              # verificarAutenticacion, verificarAdmin
â””â”€â”€ index.ts                 # Servidor Express
```

### Frontend (React):
```
src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ staff/
â”‚   â”‚   â””â”€â”€ StaffSellers.tsx      # â­ GestiÃ³n de vendedores (con eliminaciÃ³n)
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â””â”€â”€ DatabaseManager.tsx   # Administrador de BD
â”‚   â””â”€â”€ pos/
â”‚       â””â”€â”€ POS.tsx              # Punto de venta
â”œâ”€â”€ services/
â”‚   â””â”€â”€ api.ts               # â­ Servicios API (vendedoresService)
â””â”€â”€ App.tsx                  # Router principal
```

### Base de Datos:
```
database/
â”œâ”€â”€ backup_completo.sql              # â­ Backup principal (USAR ESTE)
â”œâ”€â”€ backup_completo_20251031_*.sql   # Backups con timestamp
â””â”€â”€ schema.sql                       # Esquema de tablas
```

---

**Ãšltima actualizaciÃ³n**: Octubre 31, 2025  
**VersiÃ³n**: 2.0.0  
**Estado**: ACTIVO - LEER SIEMPRE

---

## ğŸ“„ CHANGELOG

### VersiÃ³n 2.0.0 - 31 de Octubre, 2025
- âœ… Implementado sistema de eliminaciÃ³n inteligente de vendedores
- âœ… Hard delete con fallback a soft delete por Foreign Keys
- âœ… UI mejorada con advertencias visuales fuertes
- âœ… Mensajes descriptivos segÃºn tipo de eliminaciÃ³n
- âœ… AnÃ¡lisis completo de Foreign Key Constraints
- âœ… DocumentaciÃ³n actualizada (CHANGELOG.md)
- âœ… Backup completo de base de datos

### VersiÃ³n 1.0.0 - 28 de Octubre, 2025
- âœ… Sistema base de sucursales y vendedores
- âœ… AutenticaciÃ³n JWT
- âœ… Permisos por rol (admin vs sucursal)
- âœ… Docker MySQL configurado
- âœ… Frontend React + TypeScript + Ant Design
- âœ… Backend Express + TypeScript
